# This file is auto-generated by src/scripts/generate_manual_workflows.py
# Do not edit manually - changes will be overwritten by prek hook

name: 'Manual: Get Pods'
'on':
  workflow_dispatch: {}
permissions:
  id-token: write
  contents: read
jobs:
  get-pods:
    name: Get Pods
    runs-on: ubuntu-24.04
    environment: prod
    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
      with:
        sparse-checkout: .
    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@e3dd6a429d7300a6a4c196c26e071d42e0343502
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}
        aws-region: ${{ secrets.AWS_REGION }}
    - name: Install kubectl
      uses: azure/setup-kubectl@901a10e89ea615cf61f57ac05cecdf23e7de06d8
      with:
        version: latest
    - name: Update kubeconfig
      run: aws eks update-kubeconfig --name ${{ secrets.EKS_CLUSTER_NAME }} --region ${{ secrets.AWS_REGION }}
    - name: Get pods (SEE LOGS)
      run: |
        #!/bin/bash
        set -euo pipefail

        # Get pods and save output (capture both stdout and stderr for "No resources found" message)
        OUTPUT=$(kubectl get pods --sort-by=.metadata.creationTimestamp 2>&1)

        # Print to logs (plaintext version of summary)
        echo "## Kubernetes Pods"
        echo ""
        echo "$OUTPUT"
        echo ""
        echo "### Monitoring"
        echo ""
        echo "- Sentry crons overview: https://dynamical.sentry.io/insights/crons/"
        echo "- Sentry logs: https://dynamical.sentry.io/explore/logs/"

        # Write to job summary
        echo "## Kubernetes Pods" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        echo "$OUTPUT" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Monitoring" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- [Sentry crons overview](https://dynamical.sentry.io/insights/crons/)" >> $GITHUB_STEP_SUMMARY
        echo "- [Sentry logs](https://dynamical.sentry.io/explore/logs/)" >> $GITHUB_STEP_SUMMARY
