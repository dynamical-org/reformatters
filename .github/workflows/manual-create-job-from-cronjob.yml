# This file is auto-generated by src/scripts/generate_manual_workflows.py
# Do not edit manually - changes will be overwritten by pre-commit hook

name: 'Manual: Create Job from CronJob'
'on':
  workflow_dispatch:
    inputs:
      cronjob_name:
        description: CronJob to create a job from
        required: true
        type: choice
        options:
        - ecmwf-ifs-ens-forecast-15-day-0-25-degree-update
        - ecmwf-ifs-ens-forecast-15-day-0-25-degree-validate
        - nasa-smap-level3-36km-v9-update
        - nasa-smap-level3-36km-v9-validate
        - noaa-gefs-analysis-update
        - noaa-gefs-analysis-validate
        - noaa-gefs-forecast-35-day-update
        - noaa-gefs-forecast-35-day-validate
        - noaa-gfs-forecast-update
        - noaa-gfs-forecast-validate
        - noaa-hrrr-forecast-48-hour-update
        - noaa-hrrr-forecast-48-hour-validate
        - noaa-ndvi-cdr-analysis-update
        - noaa-ndvi-cdr-analysis-validate
        - u-arizona-swann-analysis-update
        - u-arizona-swann-analysis-validate
concurrency:
  group: k8s-manual-${{ github.actor }}-${{ github.run_id }}
  cancel-in-progress: false
permissions:
  id-token: write
  contents: read
jobs:
  create-job:
    name: Create Job
    runs-on: ubuntu-24.04
    environment: prod
    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
      with:
        sparse-checkout: .
    - name: Configure AWS Credentials
      uses: aws-actions/configure-aws-credentials@e3dd6a429d7300a6a4c196c26e071d42e0343502
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}
        aws-region: ${{ secrets.AWS_REGION }}
    - name: Install kubectl
      uses: azure/setup-kubectl@901a10e89ea615cf61f57ac05cecdf23e7de06d8
      with:
        version: latest
    - name: Update kubeconfig
      run: aws eks update-kubeconfig --name ${{ secrets.EKS_CLUSTER_NAME }} --region ${{ secrets.AWS_REGION }}
    - name: Generate job name and create job
      run: "#!/bin/bash\nset -euo pipefail\n\nCRONJOB_NAME=\"${{ github.event.inputs.cronjob_name }}\"\nUSERNAME=\"${{ github.actor }}\"\nRANDOM_CHARS=$(openssl rand -hex 1)\n\n# Generate job name with length limits\nif [ ${#CRONJOB_NAME} -gt 50 ]; then\n  CRONJOB_TRUNCATED=\"${CRONJOB_NAME:0:50}\"\nelse\n  CRONJOB_TRUNCATED=\"${CRONJOB_NAME}\"\nfi\n\nif [ ${#USERNAME} -gt 8 ]; then\n  USERNAME_TRUNCATED=\"${USERNAME:0:8}\"\nelse\n  USERNAME_TRUNCATED=\"${USERNAME}\"\nfi\n\nJOB_NAME=\"${CRONJOB_TRUNCATED}-${USERNAME_TRUNCATED}-${RANDOM_CHARS}\"\n\necho \"Creating job: ${JOB_NAME} from cronjob: ${CRONJOB_NAME}\"\nkubectl create job --from=cronjob/${CRONJOB_NAME} ${JOB_NAME}\n\necho \"✅ Job created successfully!\"\necho \"\"\necho \"Check job status with:\"\necho \"  gh workflow run manual-get-jobs.yml\"\necho \"\"\necho \"Or view in GitHub Actions: https://github.com/${{ github.repository }}/actions\"\n\n# Write to job summary\n{\n  echo \"## Job Created Successfully ✅\"\n  echo \"\"\n  echo\
        \ \"**CronJob:** \\`${CRONJOB_NAME}\\`\"\n  echo \"\"\n  echo \"**Job Name:** \\`${JOB_NAME}\\`\"\n  echo \"\"\n  echo \"### Next Steps\"\n  echo \"\"\n  echo \"Check job status with the [Get Jobs workflow](https://github.com/${{ github.repository }}/actions/workflows/manual-get-jobs.yml)\"\n} >> $GITHUB_STEP_SUMMARY"
